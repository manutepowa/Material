function changetoggle(){loadList($(".toggle").checkbox("is checked")?1:0)}function actualDate(){var a="0",b=new Date,c=b.getHours();if(1==c.toString().length)var d=a.concat(c);else var d=c;var e=b.getMinutes();if(1==e.toString().length)var f=a.concat(e);else var f=e;var g=b.getDate();if(1==g.toString().length)var h=a.concat(g);else var h=g;var i=b.getMonth()+1;if(1==i.toString().length)var j=a.concat(i);else var j=i;var k=b.getFullYear();return h+"/"+j+"/"+k+" a las "+d+":"+f}function dateToString(a){var b,c,d,e;return e=a.substring(0,4),d=a.substring(5,7),c=a.substring(8,10),b=c+"/"+d+"/"+e}function stringToDate(a){var b,c,d,e;return c=a.substring(0,2),d=a.substring(3,5),e=a.substring(6,10),b=e+"-"+d+"-"+c}function SelectMateriales(){var a="../function/getMaterial.php?q=all";$.ajax({url:a}).done(function(a){var b=$.parseJSON(a);$.each(b,function(a,b){$.each(b,function(a){$('select[name="materiales"]').append($("<option>",{value:b[a].descripcion,text:b[a].descripcion}))})})})}function SelectPersonas(){var a="../function/getPerson.php?q=all";$.ajax({url:a}).done(function(a){var b=$.parseJSON(a);$.each(b,function(a,b){$.each(b,function(a){$('select[name="persona"]').append($("<option>",{value:b[a].nombre,text:b[a].nombre}))})})})}function SelectLugares(){var a="../function/getLugar.php?q=all";$.ajax({url:a}).done(function(a){var b=$.parseJSON(a);$.each(b,function(a,b){$.each(b,function(a){$('select[name="lugar"]').append($("<option>",{value:b[a].lugar,text:b[a].lugar}))})})})}function loadList(a){var b="../function/getPrestamo.php?q="+a;$("#prestamos tbody").html("");var c,d,e,f,g=0;$.ajax({url:b,beforeSend:Loader}).done(function(a){var b=$.parseJSON(a);if(0==b.length){var h="<tr class='center'><td colspan='7'>No hay préstamos que cumplan con las características indicadas.</td></tr>";$(h).appendTo("#prestamos tbody")}else $.each(b,function(a,h){if(c=dateToString(h.fecha_prestamo.substring(0,10)),d=h.fecha_prestamo.substring(11,16),0==a){var i;if(h.fecha_devolucion?(e=dateToString(h.fecha_devolucion.substring(0,10)),f=h.fecha_devolucion.substring(11,16),i=e+" a las "+f):(i="No devuelto",g=1),1==g){var j="<tr class='negative' data-value='"+h.id_prestamo+"'>";g=0}else var j="<tr data-value='"+h.id_prestamo+"'>";j+="<td><i class='large info circle icon' data-user='"+h.id_usuario+"' data-title='Creado el &#39;"+h.fecha_creacion+"&#39; por &#39;"+h.nombre_usuario+"&#39;' data-content='"+h.observaciones+"' data-variation='inverted very wide'></i></td><td>"+h.descripcion+"</td><td>"+h.nombre+"</td><td>"+h.lugar+"</td><td>"+c+" a las "+d+"</td><td>"+i+"</td>",j+="No devuelto"!==i?"<td style='text-align:center'><div class='ui icon top left pointing dropdown button'><i class='setting icon'></i><div class='menu'><div class='dev disabled item'><i class='checked calendar icon'></i>Devolver</div><div class='mod item'><i class='edit icon'></i>Modificar</div><div class='del item'><i class='trash icon'></i>Eliminar</div></div></div><input type='hidden' name='id-prest' value='"+h.id_prestamo+"'/></td></tr>":"<td style='text-align:center'><div class='ui icon top left pointing dropdown button'><i class='setting icon'></i><div class='menu'><div class='dev item'><i class='checked calendar icon'></i>Devolver</div><div class='mod item'><i class='edit icon'></i>Modificar</div><div class='del item'><i class='trash icon'></i>Eliminar</div></div></div><input type='hidden' name='id-prest' value='"+h.id_prestamo+"'/></td></tr>",$(j).appendTo("#prestamos tbody")}else if(h.id_prestamo==b[a-1].id_prestamo)$("tr[data-value='"+b[a-1].id_prestamo+"']>td:nth-child(2)").append(" &nbsp;<strong>||</strong>&nbsp; "+h.descripcion);else{var i;if(h.fecha_devolucion?(e=dateToString(h.fecha_devolucion.substring(0,10)),f=h.fecha_devolucion.substring(11,16),i=e+" a las "+f):(i="No devuelto",g=1),1==g){var j="<tr class='negative' data-value='"+h.id_prestamo+"'>";g=0}else var j="<tr data-value='"+h.id_prestamo+"'>";j+="<td><i class='large info circle icon' data-user='"+h.id_usuario+"' data-title='Creado el &#39;"+h.fecha_creacion+"&#39; por &#39;"+h.nombre_usuario+"&#39;' data-content='"+h.observaciones+"' data-variation='inverted very wide'></i></td><td>"+h.descripcion+"</td><td>"+h.nombre+"</td><td>"+h.lugar+"</td><td>"+c+" a las "+d+"</td><td>"+i+"</td>",j+="No devuelto"!==i?"<td style='text-align:center'><div class='ui icon top left pointing dropdown button'><i class='setting icon'></i><div class='menu'><div class='dev disabled item'><i class='checked calendar icon'></i>Devolver</div><div class='mod item'><i class='edit icon'></i>Modificar</div><div class='del item'><i class='trash icon'></i>Eliminar</div></div></div><input type='hidden' name='id-prest' value='"+h.id_prestamo+"'/></td></tr>":"<td style='text-align:center'><div class='ui icon top left pointing dropdown button'><i class='setting icon'></i><div class='menu'><div class='dev item'><i class='checked calendar icon'></i>Devolver</div><div class='mod item'><i class='edit icon'></i>Modificar</div><div class='del item'><i class='trash icon'></i>Eliminar</div></div></div><input type='hidden' name='id-prest' value='"+h.id_prestamo+"'/></td></tr>",$(j).appendTo("#prestamos tbody")}}),incluirPaginador("#prestamos","#paginadorPrestamos");$(".info.circle.icon").popup(),$("#prestamos .ui.dropdown, #administrar_container .ui.secondary.pointing.menu .ui.dropdown").dropdown({action:"nothing",action:"hide"}),$("#addusuario_segment .ui.dropdown").dropdown(),$("#addprestamo .ui.search.selection.dropdown").dropdown(),$("#addprestamo .ui.multiple.selection.dropdown").dropdown(),$(".section").css("visibility","hidden"),$(".section").css("display","none"),$("#prestamos").css("visibility","visible")})}function incluirPaginador(a,b){var c=$(a).find("tbody tr").length;$(a).find("tbody tr").hide().slice(0,15).show(),totalPaginasPrestamos=c/15;var d="<a id='btnPagAtras' class='item'><i class='left arrow icon'></i>Atras</a><a id='numPagina1' class='item active'>1</a>";for(i=2;i<=Math.ceil(totalPaginasPrestamos);i++)d+="<a id='numPagina"+i+"' class='item'>"+i+"</a>";d+="<a id='btnPagSiguiente' class='item'>Siguiente <i class='icon right arrow'></i></a>",$(b).html(d);var e=0;$(b+" a[id^=numPagina]").click(function(b){var c=$(this).text().trim();$("a.item").removeClass("active"),$(this).addClass("item active"),$(a).find("tbody tr").hide().slice(15*c-15,15*c).show()}),$(b+" #btnPagSiguiente").click(function(c){e=$(b+" a[id^=numPagina].item.active").text().trim(),siguientePagina=parseInt(e),siguientePagina++,siguientePagina>Math.ceil(totalPaginasPrestamos)||($("a.item").removeClass("active"),$(b+" #numPagina"+siguientePagina).addClass("active"),$(a).find("tbody tr").hide().slice(15*siguientePagina-15,15*siguientePagina).show())}),$(b+" #btnPagAtras").click(function(c){e=$(b+" a[id^=numPagina].item.active").text().trim(),anteriorPagina=parseInt(e),anteriorPagina--,anteriorPagina<=0||($("a.item").removeClass("active"),$(b+" #numPagina"+anteriorPagina).addClass("active"),$(a).find("tbody tr").hide().slice(15*anteriorPagina-15,15*anteriorPagina).show())})}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}$(document).ready(function(){function a(a){console.log(a)}var b,c=1,d=1,e=0,f="<div class='ui relaxed divided list'><div class='item'><table class='modper'><tr><td><div class='ui search medium' id='mper'><div class='ui icon input'><input id='mpersona' class='prompt' type='text' placeholder='Buscar Persona...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large user big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay persona añadida</div></div></td><td></td></tr></table></div><div class='item'><table class='modlug'><tr><td><div class='ui search medium' id='mlug'><div class='ui icon input'><input id='mlugar' class='prompt' type='text' placeholder='Buscar Lugar...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large world big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay lugar añadido</div></div></td><td></td></tr></table></div><div class='item'><table class='moddate'><tr><td><div class='ui input'><input type='date' id='mdate'><input type='time' id='mtime'></div></td><td><i class='large calendar big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay fecha añadida</div></div></td><td></td></tr></table></div><div class='item'><div class='ui form'><div class='field'><textarea id='mobser' placeholder='Observaciones...' rows='2'></textarea></div></div></div></div>";$(".toggle").checkbox("set checked"),$("#advadd > .close.icon, #advmod > .close.icon, #advdev > .close.icon, #advdel > .close.icon, #advaddpre > .close.icon, #advaddmat > .close.icon, #advaddper > .close.icon, #advaddlug > .close.icon, #advaddusu > .close.icon").on("click",function(){$(this).closest(".ui.positive.message").hide()}),$("#erraddpres > .close.icon, #erraddprescrear > .close.icon, #errmodpres > .close.icon, #errmodprescrear > .close.icon, #erraddprestamo > .close.icon, #erraddmat > .close.icon, #erraddper > .close.icon, #erraddlug > .close.icon, #erraddusu > .close.icon, #erraddusupass > .close.icon, #erraddusuname > .close.icon, #erraddmaterial > .close.icon, #erraddpersona > .close.icon, #erraddlugar > .close.icon").on("click",function(){$(this).closest(".ui.negative.message").hide()}),$(".toggle").change(function(){$(".filtro input:text").val(""),loadList($(this).checkbox("is checked")?1:0)}),SelectMateriales(),SelectPersonas(),SelectLugares(),changetoggle(),"SI"==getCookie("addPrestamoOK")&&($("#advaddpre").css("display","block"),$("#advaddpre").css("visibility","visible"),$("#advaddpre").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),document.cookie="addPrestamoOK=NO"),"SI"==getCookie("addMaterialOK")&&($("#advaddmat").css("display","block"),$("#advaddmat").css("visibility","visible"),$("#advaddmat").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),document.cookie="addMaterialOK=NO"),"SI"==getCookie("addPersonaOK")&&($("#advaddper").css("display","block"),$("#advaddper").css("visibility","visible"),$("#advaddper").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),document.cookie="addPersonaOK=NO"),"SI"==getCookie("addLugarOK")&&($("#advaddlug").css("display","block"),$("#advaddlug").css("visibility","visible"),$("#advaddlug").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),document.cookie="addLugarOK=NO"),$(document).on("click",".minus.circle.icon",function(a){var b=$(this).closest("table[class ^= addlistadomat]").parent(".item"),c=$(this).closest(".description");b.is(":last-child")?($(this).closest(".item").remove(),$ultimo=c.find(".item:last"),$icono=$ultimo.find(".circle"),"addlistadomatm"==b.find("table[class ^= addlistadomat]")[0].className?$icono.removeClass("minus circle icon").addClass("add circle icon").attr("id","maddRowMat"):$icono.removeClass("minus circle icon").addClass("add circle icon").attr("id","addRowMat"),$ultimo.is(":nth-child(5)")||$ultimo.find("td:last-child").append('<i class="minus circle icon"></i>')):($ultimo=c.find(".item:last"),$ultimo.is(":nth-child(5)")||($(this).closest(".item").remove(),$ultimo.is(":nth-child(5)")&&($icono=$ultimo.find(".minus.circle.icon"),$icono.remove())))}),$(document).on("click","#addRowMat",function(a){for(var b=$("#modal-add-prest").find(":text"),d=0,e=2;e<b.length;e++)""==b[e].value&&d++;if(d>0)return alert("Rellene todas las líneas de material antes de añadir uno nuevo."),!1;var f=$(this).closest(".addlistadomat").parent(".item");f.is(":nth-child(5)")?$(this).removeClass("add circle icon").addClass("minus circle icon"):$(this).remove(),$(this).removeAttr("id");var g="<div class='item'><table class='addlistadomat'><tr><td><div class='ui search medium' id='mat_"+c+"'><div class='ui icon input'><input id='material_"+c+"' name='material[]' class='prompt' type='text' placeholder='Buscar Material...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large archive big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay material añadido</div></div></td><td><i id='addRowMat' class='add circle icon'></i><i class='minus circle icon'></i></td></tr></table></div>";$(g).appendTo("#modal-add-prest .ui.relaxed.divided.list"),c++}),$(document).on("click","#maddRowMat",function(a){for(var b=0,c=$("#modal-mod-prest").find(":text"),d=2;d<c.length;d++)""==c[d].value&&b++;if(b>0)return alert("Rellene todas las líneas de material antes de añadir uno nuevo."),!1;var f=$(this).closest(".addlistadomatm").parent(".item");f.is(":nth-child(5)")?$(this).removeClass("add circle icon").addClass("minus circle icon"):$(this).remove(),$(this).removeAttr("id");var g="<div class='item'><table class='addlistadomatm'><tr><td><div class='ui search medium' id='mmat_"+e+"'><div class='ui icon input'><input id='mmaterial_"+e+"' name='mmaterial[]' class='prompt' type='text' placeholder='Buscar Material...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large archive big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay material añadido</div></div></td><td><i id='maddRowMat' class='add circle icon'></i><i class='minus circle icon'></i></td></tr></table></div>";$(g).appendTo("#modal-mod-prest .ui.relaxed.divided.list")}),$(document).on("click",".results",function(){var a=$(this).parents("tr").find(".description"),b=$(this).siblings(".input").find("input").val();a.html(b)}),$(".ui.accordion").accordion(),$(document).on("change","#modal-add-prest input[type=date], #modal-mod-prest input[type=date]",function(){var a=$(this).parents("tr").find(".description"),b=$(this).siblings("input[type=time]").val();""==b?a.html("Prestado el "+dateToString($(this).val())):a.html("Prestado el "+dateToString($(this).val())+" a las "+b)}),$(document).on("change","#modal-add-prest input[type=time], #modal-mod-prest input[type=time]",function(){var a=$(this).parents("tr").find(".description"),b=$(this).siblings("input[type=date]").val();""==$(this).val()?a.html("Prestado el "+dateToString(b)):a.html("Prestado el "+dateToString(b)+" a las "+$(this).val())}),$("#per").search({apiSettings:{url:"../function/getPerson.php?q={query}"},fields:{results:"personas",title:"nombre"},minCharacters:1,error:{noResults:'<p class="center bold">Persona no encontrada.</p><button class="ui button teal add" id="addp">Crear persona</button>',serverError:'<p class="center bold">Cargando . . .</p>'}}),$("#lug").search({apiSettings:{url:"../function/getLugar.php?q={query}"},fields:{results:"lugares",title:"lugar"},minCharacters:1,error:{noResults:'<p class="center bold">Lugar no encontrado.</p><button class="ui button teal add" id="addl">Crear lugar</button>',serverError:'<p class="center bold">Cargando . . .</p>'}}),$(document).on("keyup","div[id ^= mat]",function(){$(this).search({apiSettings:{url:"../function/getMaterial.php?q={query}"},fields:{results:"materiales",title:"descripcion"},minCharacters:1,error:{noResults:'<p class="center bold">Material no encontrado.</p><button class="ui button teal add" id="addm">Crear material</button>',serverError:'<p class="center bold">Cargando . . .</p>'}})}),$(document).on("keyup","#mper",function(){$(this).search({apiSettings:{url:"../function/getPerson.php?q={query}"},fields:{results:"personas",title:"nombre"},minCharacters:1,error:{noResults:'<p class="center bold">Persona no encontrada.</p><button class="ui button teal add" id="addmp">Crear persona</button>',serverError:'<p class="center bold">Cargando . . .</p>'}})}),$(document).on("keyup","#mlug",function(){$(this).search({apiSettings:{url:"../function/getLugar.php?q={query}"},fields:{results:"lugares",title:"lugar"},minCharacters:1,error:{noResults:'<p class="center bold">Lugar no encontrado.</p><button class="ui button teal add" id="addml">Crear lugar</button>',serverError:'<p class="center bold">Cargando . . .</p>'}})}),$(document).on("keyup","div[id ^= mmat]",function(){$(this).search({apiSettings:{url:"../function/getMaterial.php?q={query}"},fields:{results:"materiales",title:"descripcion"},minCharacters:1,error:{noResults:'<p class="center bold">Material no encontrado.</p><button class="ui button teal add" id="addmm">Crear material</button>',serverError:'<p class="center bold">Cargando . . .</p>'}})}),$(document).on("click",".mod",function(c){c.preventDefault(),b=$(this).parent().parent().siblings("input").val(),e=b;var g=$(this).parent().parent().parent().parent(),h="../function/getLineasPrestamo.php?q="+b;$("#modal-mod-prest .ui.relaxed.divided.list").replaceWith(f);var i=0;$.getJSON(h,function(a){$.each(a,function(a,b){if(0==a){var c="<div class='item'><table class='addlistadomatm'><tr><td><div class='ui search medium' id='mmat_"+a+"'><div class='ui icon input'><input id='mmaterial_"+a+"' name='mmaterial[]' data-idmat='"+b.id_material+"' value='"+b.descripcion+"' class='prompt' type='text' placeholder='Buscar Material...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large archive big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay material añadido</div></div></td><td><i id='maddRowMat' class='add circle icon'></i><i class='minus circle icon'></i></td></tr></table></div>";$(c).appendTo("#modal-mod-prest .ui.relaxed.divided.list")}else{$("#maddRowMat").remove();var c="<div class='item'><table class='addlistadomatm'><tr><td><div class='ui search medium' id='mmat_"+a+"'><div class='ui icon input'><input id='mmaterial_"+a+"' name='mmaterial[]' data-idmat='"+b.id_material+"' value='"+b.descripcion+"' class='prompt' type='text' placeholder='Buscar Material...'><i class='search icon'></i></div><div class='results'></div></div></td><td><i class='large archive big aligned icon icpres'></i></td><td><div class='content'><div class='description'>No hay material añadido</div></div></td><td><i id='maddRowMat' class='add circle icon'></i><i class='minus circle icon'></i></td></tr></table></div>";$(c).appendTo("#modal-mod-prest .ui.relaxed.divided.list")}$("#mmaterial_"+a).parents("table").find(".description").html(b.descripcion),i++}),1==i&&$(".minus.circle.icon").remove()});var j=g.children("td").eq(0).find("i").data("content"),k=g.children("td").eq(0).find("i").data("user"),l=(g.children("td").eq(1).text(),g.children("td").eq(2).text()),m=g.children("td").eq(3).text(),n=g.children("td").eq(4).text(),o=stringToDate(n.substring(0,10)),p=n.substring(17,23);$(".modal .message").fadeOut(0),$("#modal-mod-prest").find("#mpersona").val(l),$("#modal-mod-prest").find("#mlugar").val(m),$("#modal-mod-prest").find("#mdate").val(o),$("#modal-mod-prest").find("#mtime").val(p),$("#modal-mod-prest").find("#mobser").val(j),$("#mpersona").parents("tr").find(".description").html(l),$("#mlugar").parents("tr").find(".description").html(m),$("#mdate").parents("tr").find(".description").html("Prestado el "+dateToString(o)+" a las "+p),$("#modal-mod-prest").modal({blurring:!0,onApprove:function(){for(var c=0,d=$("#mpersona").val(),e=$("#mlugar").val(),f=$("input[name='mmaterial[]']"),g=[],h=0;h<f.length;h++)g[h]=f[h].value,""==g[h]&&(a("nommaterial: "+c),c++);var i=$("#mdate").val(),j=$("#mtime").val(),l=k,m=$("#mobser").val();return""==d||""==e||0!=c||""==i||""==j?($("#errmodprescrear").fadeOut(0),$("#errmodpres").fadeIn(0),!1):void $.ajax({url:"../function/modPrestamo.php",type:"POST",data:{per:d,lug:e,mat:g,dat:i,time:j,user:l,obser:m,"id-prest":b},success:function(b){"1"==b?($("#advmod").css("display","block"),$("#advmod").css("visibility","visible"),$("#advmod").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),changetoggle()):"2"==b?a("Error update material.prestamo"):"3"==b?a("Error insert material.lineas_prestamo"):"4"==b?a("Error delete material.lineas_prestamo"):(a("error ajax ("+b+")"),$(".modal .message").fadeOut(0),$("#modal-mod-prest").modal("show"),$("#errmodprescrear").fadeIn(0))}})}}).modal("show"),d=1}),$(document).on("click",".dev",function(a){a.preventDefault(),$(".modal .message").fadeOut(0),b=$(this).parent().parent().siblings("input").val(),$("#mod-dev").modal("show")}),$(document).on("click",".del",function(a){a.preventDefault(),b=$(this).parent().parent().siblings("input").val(),$("#mod-del").modal("show")}),$(document).on("click","#actual-date",function(a){a.preventDefault();var c=new Date,d=c.getMonth()+1,e=c.getFullYear()+"-"+d+"-"+c.getDate(),f=c.getHours()+":"+c.getMinutes();$.ajax({url:"../function/addDevolucion.php",type:"POST",data:{"dat-dev":e,"time-dev":f,"id-prest":b}}).done(function(){$("#advdev").css("display","block"),$("#advdev").css("visibility","visible"),$("#advdev").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),$("#mod-dev").modal("hide"),changetoggle()})}),$(document).on("change",'input[name$="dat-dev"]',function(a){$(".modal .message").fadeOut(0)}),$(document).on("click","#date-select",function(a){a.preventDefault();var c=$(this).siblings("input[type=date]").val(),d=$(this).siblings("input[type=time]").val();return""==c||""==d?($("#errdevpres").fadeIn(0),!1):($.ajax({url:"../function/addDevolucion.php",type:"POST",data:{"dat-dev":c,"time-dev":d,"id-prest":b}}).done(function(){$("#advdev").css("display","block"),$("#advdev").css("visibility","visible"),$("#advdev").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),$("#mod-dev").modal("hide"),changetoggle()}),$(this).siblings("input[type=date]").val(""),void $(this).siblings("input[type=time]").val(""))}),$(document).on("click",".approve",function(a){a.preventDefault(),$.ajax({url:"../function/delPrestamo.php",type:"POST",data:{"id-prest":b},beforeSend:Loader,success:function(a){"1"==a&&(document.cookie="delPrestamoOK=SI",location.reload())}})}),$(document).on("click","#addp, #addmp",function(a){a.preventDefault(),$("#per").search("clear cache"),$("#mper").search("clear cache");var b=$(this).parents(".results").siblings(".icon.input").find(".prompt").val();$.ajax({url:"../function/addPerson.php",type:"POST",data:{nombre:b},success:function(a){return"1"!=a?(alert("¡Error al añadir la nueva persona!"),!1):($("#persona").focus(),void $("#mpersona").focus())}})}),$(document).on("click","#addm, #addmm",function(a){a.preventDefault(),$("div[id ^= mat]").search("clear cache"),$("div[id ^= mmat]").search("clear cache");var b=$(this).parents("div[id ^= mat_]").find("input[id ^= material_]"),c=$(this).parents("div[id ^= mmat_]").find("input[id ^= mmaterial_]"),d=$(this).parents(".results").siblings(".icon.input").find(".prompt").val();$.ajax({url:"../function/addMaterial.php",type:"POST",data:{descripcion:d},success:function(a){return"1"!=a?(alert("¡Error al añadir el nuevo material!"),!1):($(b).focus(),void $(c).focus())}})}),$(document).on("click","#addl, #addml",function(a){a.preventDefault(),$("#lug").search("clear cache"),$("#mlug").search("clear cache");var b=$(this).parents(".results").siblings(".icon.input").find(".prompt").val();$.ajax({url:"../function/addLugar.php",type:"POST",data:{lugar:b},success:function(a){return"1"!=a?(alert("¡Error al añadir el nuevo lugar!"),!1):($("#lugar").focus(),void $("#mlugar").focus())}})}),$("#addprestamo").form({onSuccess:function(){if(13==event.keyCode||13==event.which)return!1;$("#erraddprestamo").fadeOut(0);var a=$('select[name="materiales"]').val(),b=$("#addprestamo").find(".ui.submit.button").data("user"),c=$("#addprestamo").find('select[name="persona"]').val(),d=$("#addprestamo").find('select[name="lugar"]').val(),e=$("#addprestamo").find('input[name="date"]').val(),f=$("#addprestamo").find('input[name="time"]').val(),g=$("#addprestamo").find('textarea[name="observaciones"]').val(),h=actualDate();return""==c||""==d||""==e||""==f||null==a?($("#erraddprestamo").fadeIn(0),!1):void $.ajax({url:"../function/addPrestamo.php",type:"POST",data:{per:c,lug:d,dat:e,time:f,user:b,obser:g,mat:a,creac:h},beforeSend:Loader,success:function(a){"1"==a?(document.cookie="addPrestamoOK=SI",location.reload()):console.log("ERROR AL AÑADIR UN NUEVO PRESTAMO")}})}}),$("#addmaterial").form({onSuccess:function(){if(13==event.keyCode||13==event.which)return!1;$("#erraddmat").fadeOut(0),$("#erraddmaterial").fadeOut(0);var a=$("#addmaterial").find('input[name="material"]').val();return""==a?($("#erraddmat").fadeIn(0),!1):void $.ajax({url:"../function/addMaterial.php",type:"POST",data:{descripcion:a},beforeSend:Loader,success:function(a){if("1"==a)document.cookie="addMaterialOK=SI",location.reload();else{if("2"==a)return $("#erraddmaterial").fadeIn(0),$(".section").css("visibility","hidden"),$(".section").css("display","none"),!1;console.log("ERROR AL AÑADIR UN NUEVO MATERIAL")}}})}}),$("#addpersona").form({onSuccess:function(){if(13==event.keyCode||13==event.which)return!1;$("#erraddper").fadeOut(0),$("#erraddpersona").fadeOut(0);var a=$("#addpersona").find('input[name="persona"]').val();return""==a?($("#erraddper").fadeIn(0),!1):void $.ajax({url:"../function/addPerson.php",type:"POST",data:{nombre:a},beforeSend:Loader,success:function(a){if("1"==a)document.cookie="addPersonaOK=SI",location.reload();else{if("2"==a)return $("#erraddpersona").fadeIn(0),$(".section").css("visibility","hidden"),$(".section").css("display","none"),!1;console.log("ERROR AL AÑADIR UNA NUEVA PERSONA")}}})}}),$("#addlugar").form({onSuccess:function(){if(13==event.keyCode||13==event.which)return!1;$("#erraddlug").fadeOut(0),$("#erraddlugar").fadeOut(0);var a=$("#addlugar").find('input[name="lugar"]').val();return""==a?($("#erraddlug").fadeIn(0),!1):void $.ajax({url:"../function/addLugar.php",type:"POST",data:{lugar:a},beforeSend:Loader,success:function(a){if("1"==a)document.cookie="addLugarOK=SI",location.reload();else{if("2"==a)return $("#erraddlugar").fadeIn(0),$(".section").css("visibility","hidden"),$(".section").css("display","none"),!1;console.log("ERROR AL AÑADIR UN NUEVO LUGAR")}}})}}),$("#addusuario").form({onSuccess:function(){if(13==event.keyCode||13==event.which)return!1;$("#erraddusu").fadeOut(0),$("#erraddusupass").fadeOut(0);var a=$("#addusuario").find('input[name="usuario"]').val(),b=$("#addusuario").find('input[name="contrasena"]').val(),c=$("#addusuario").find('input[name="repcontrasena"]').val(),d=$("#addusuario").find('select[name="privilegios"]').val();return""==a||""==b||""==c||""==d?($("#erraddusu").fadeIn(0),!1):c!=b?($("#erraddusupass").fadeIn(0),!1):void $.ajax({url:"../function/checkUser.php",type:"POST",data:{usuario:a},beforeSend:Loader,success:function(c){return"0"!=c?($("#erraddusuname").fadeIn(0),$(".section").css("visibility","hidden"),$(".section").css("display","none"),!1):void $.ajax({url:"../function/addUsuario.php",type:"POST",data:{usuario:a,privilegios:d,contrasena:b},beforeSend:Loader,success:function(a){"1"==a?($("#advaddusu").css("display","block"),$("#advaddusu").css("visibility","visible"),$("#advaddusu").delay(5e3).queue(function(a){$(this).css("visibility","hidden"),a()}),$("#addusuario").find('input[name="usuario"]').val(""),$("#addusuario").find('input[name="contrasena"]').val(""),$("#addusuario").find('input[name="repcontrasena"]').val(""),$(".ui.dropdown.selection").find(".text").addClass("default"),$(".ui.dropdown.selection").find(".text.default").html("Seleccionar privilegios"),$(".ui.dropdown.selection").find(".item.active.selected").removeClass("active selected"),$(".section").css("visibility","hidden"),$(".section").css("display","none")):console.log("ERROR AL AÑADIR UN NUEVO USUARIO")}})}})}})});